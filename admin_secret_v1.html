<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Rio Preto - Admin Terminal</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        body {
            background-color: #0f172a;
            color: #38bdf8;
            font-family: 'Courier New', Courier, monospace;
        }

        .monitor {
            box-shadow: 0 0 20px rgba(56, 189, 248, 0.2);
            border: 1px solid #1e293b;
        }

        .blink {
            animation: blinker 1s linear infinite;
        }

        @keyframes blinker {
            50% {
                opacity: 0;
            }
        }
    </style>
</head>

<body class="min-h-screen flex items-center justify-center p-4">

    <div class="monitor w-full max-w-2xl bg-slate-900 rounded-lg p-6 relative overflow-hidden">
        <!-- Header -->
        <div class="flex justify-between items-center mb-6 border-b border-slate-700 pb-4">
            <div class="flex items-center gap-2">
                <i class="fas fa-terminal text-green-400"></i>
                <h1 class="font-bold text-lg text-slate-200">SYSTEM_OVERRIDE_V1</h1>
            </div>
            <div class="text-xs text-slate-500">CONNECTED: SUPABASE_EDGE</div>
        </div>

        <!-- API Configuration (Saved in LocalStorage) -->
        <div class="mb-6">
            <label class="block text-xs text-slate-500 mb-1">SUPABASE_ANON_KEY</label>
            <input type="password" id="apiKey"
                class="w-full bg-slate-800 border border-slate-700 rounded px-3 py-2 text-xs text-slate-300 focus:border-blue-500 outline-none transition"
                placeholder="Paste your Anon Key here...">
        </div>

        <!-- Input Area -->
        <div class="mb-4">
            <label class="block text-xs text-slate-500 mb-1">INPUT_STREAM (Natural Language)</label>
            <textarea id="inputText" rows="4"
                class="w-full bg-slate-800 border border-slate-700 rounded-lg p-4 text-slate-200 focus:border-green-500 outline-none transition font-mono"
                placeholder="Ex: Reserva chale 06 dia 31/12 a 01/01 para 4 pessoas..."></textarea>
            <div class="text-right mt-1">
                <button onclick="processCommand()"
                    class="bg-green-600 hover:bg-green-500 text-black font-bold py-2 px-6 rounded text-sm transition-all shadow-lg shadow-green-900/50">
                    <i class="fas fa-play mr-2"></i> EXECUTE
                </button>
            </div>
        </div>

        <!-- Output Console -->
        <div class="bg-black rounded border border-slate-800 p-4 h-48 overflow-y-auto font-mono text-sm"
            id="consoleOutput">
            <div class="text-slate-500">Waiting for input... <span class="blink">_</span></div>
        </div>
    </div>

    <script>
        // Load Key
        const keyInput = document.getElementById('apiKey');
        // Hardcoded Key from scripts.js
        const HARDCODED_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImhpaGFpcGFzbG5wYXFucW90cndtIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjQyNjE1OTIsImV4cCI6MjA3OTgzNzU5Mn0.zwPHKlcYNQnlQbQdf83qbH3mk4Dsc8fVF4NfWDBs_LA";

        keyInput.value = HARDCODED_KEY;

        const FUNCTION_URL = "https://hihaipaslnpaqnqotrwm.supabase.co/functions/v1/smooth-handler";

        async function processCommand() {
            const text = document.getElementById('inputText').value;
            const key = document.getElementById('apiKey').value;
            const consoleDiv = document.getElementById('consoleOutput');

            if (!text || !key) {
                log("ERROR: Missing Text or API Key", "text-red-500");
                return;
            }

            log(`> Sending data: "${text.substring(0, 30)}..."`, "text-yellow-500");

            try {
                const response = await fetch(FUNCTION_URL, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${key}`
                    },
                    body: JSON.stringify({
                        text: text,
                        sender: 'Admin Console'
                    })
                });

                const data = await response.json();

                if (response.ok && data.success) {
                    log("SUCCESS: Database Updated.", "text-green-400");
                    log(data.message.replace(/\n/g, '<br>'), "text-white pl-4 border-l-2 border-green-500 my-2");
                    document.getElementById('inputText').value = ""; // Clear
                } else {
                    log(`FAILURE: ${data.message || "Unknown Error"}`, "text-red-400 font-bold");
                    if (data.debug) log(JSON.stringify(data.debug), "text-xs text-gray-500");
                }

            } catch (err) {
                log(`CRITICAL ERROR: ${err.message}`, "text-red-600 bg-red-900/20 p-2");
            }
        }

        function log(msg, classes = "text-slate-300") {
            const consoleDiv = document.getElementById('consoleOutput');
            const line = document.createElement('div');
            line.className = `mb-1 ${classes}`;
            line.innerHTML = `<span class="opacity-50 mr-2">[${new Date().toLocaleTimeString()}]</span> ${msg}`;
            consoleDiv.prepend(line);
        }
    </script>
</body>

</html>